<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.8.1" />
<title>speclet.bayesian_models.eight_schools API documentation</title>
<meta name="description" content="Classic eight-schools example." />
<link href='https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.min.css' rel='stylesheet'>
<link href='https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/8.0.0/sanitize.min.css' rel='stylesheet'>
<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" rel="stylesheet">
<style>.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script async src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS_CHTML'></script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>speclet.bayesian_models.eight_schools</code></h1>
</header>
<section id="section-intro">
<p>Classic eight-schools example.</p>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">&#34;&#34;&#34;Classic eight-schools example.&#34;&#34;&#34;

from dataclasses import asdict, dataclass
from typing import Any, Optional

import numpy as np
import pandas as pd
import pymc3 as pm
import stan
from stan.model import Model as StanModel

from speclet.project_enums import ModelFitMethod

_eight_schools_stan_code = &#34;&#34;&#34;
data {
    int&lt;lower=0&gt; J;
    real y[J];
    real&lt;lower=0&gt; sigma[J];
}

parameters {
    real mu;
    real&lt;lower=0&gt; tau;
    real theta_tilde[J];
}

transformed parameters {
    real theta[J];

    for (j in 1:J) {
        theta[j] = mu + tau * theta_tilde[j];
    }
}

model {
    mu ~ normal(0, 5);
    tau ~ cauchy(0, 5);
    theta_tilde ~ normal(0, 1);
    y ~ normal(theta, sigma);
}

generated quantities {
    vector[J] log_lik;
    vector[J] y_hat;

    for (j in 1:J) {
        log_lik[j] = normal_lpdf(y[j] | theta[j], sigma[j]);
        y_hat[j] = normal_rng(theta[j], sigma[j]);
    }
}
&#34;&#34;&#34;


@dataclass(frozen=True)
class SchoolsData:
    &#34;&#34;&#34;Data structure for the eight-schools data.&#34;&#34;&#34;

    J: int
    y: list[float]
    sigma: list[int]


class EightSchoolsModel:
    &#34;&#34;&#34;Classic eight-schools example model.&#34;&#34;&#34;

    def __init__(self) -&gt; None:
        &#34;&#34;&#34;Classic eight-schools example model.&#34;&#34;&#34;
        return None

    def vars_regex(self, fit_method: ModelFitMethod) -&gt; list[str]:
        &#34;&#34;&#34;Regular expression to help with plotting only interesting variables.&#34;&#34;&#34;
        return [r&#34;.*&#34;]

    @property
    def schools_data(self) -&gt; SchoolsData:
        &#34;&#34;&#34;Eight-schools data.&#34;&#34;&#34;
        return SchoolsData(
            J=8, y=[28, 8, -3, 7, -1, 1, 18, 12], sigma=[15, 10, 16, 11, 9, 11, 10, 18]
        )

    def stan_model(
        self, data: pd.DataFrame, random_seed: Optional[int] = None
    ) -&gt; StanModel:
        &#34;&#34;&#34;Stan model for a the eight-schools example.

        Args:
            data (pd.DataFrame): Ignored.
            random_seed (Optional[int], optional): Random seed. Defaults to None.

        Returns:
            StanModel: Stan model.
        &#34;&#34;&#34;
        return stan.build(
            _eight_schools_stan_code,
            data=asdict(self.schools_data),
            random_seed=random_seed,
        )

    @property
    def stan_idata_addons(self) -&gt; dict[str, Any]:
        &#34;&#34;&#34;Information to add to the InferenceData posterior object.&#34;&#34;&#34;
        return {
            &#34;posterior_predictive&#34;: &#34;y_hat&#34;,
            &#34;observed_data&#34;: [&#34;y&#34;],
            &#34;log_likelihood&#34;: {&#34;y&#34;: &#34;log_lik&#34;},
            &#34;constant_data&#34;: [&#34;sigma&#34;],
            &#34;coords&#34;: {&#34;school&#34;: np.arange(self.schools_data.J)},
            &#34;dims&#34;: {
                &#34;theta&#34;: [&#34;school&#34;],
                &#34;y&#34;: [&#34;school&#34;],
                &#34;log_lik&#34;: [&#34;school&#34;],
                &#34;y_hat&#34;: [&#34;school&#34;],
                &#34;theta_tilde&#34;: [&#34;school&#34;],
            },
        }

    def pymc3_model(self, data: pd.DataFrame) -&gt; pm.Model:
        &#34;&#34;&#34;PyMC3  model for a simple negative binomial model.

        Not implemented.

        Args:
            data (pd.DataFrame): Ignored.

        Returns:
            pm.Model: PyMC3 model.
        &#34;&#34;&#34;
        school_data = self.schools_data
        with pm.Model() as model:
            mu = pm.Normal(&#34;mu&#34;, 0, 5)
            tau = pm.HalfCauchy(&#34;tau&#34;, 5)
            theta_tilde = pm.Normal(&#34;eta&#34;, 0, 1)
            theta = pm.Deterministic(&#34;theta&#34;, mu + tau * theta_tilde)
            y = pm.Normal(  # noqa: F841
                name=&#34;y&#34;,
                mu=theta,
                sigma=np.array(school_data.sigma),
                observed=school_data.y,
            )
        return model</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="speclet.bayesian_models.eight_schools.EightSchoolsModel"><code class="flex name class">
<span>class <span class="ident">EightSchoolsModel</span></span>
</code></dt>
<dd>
<div class="desc"><p>Classic eight-schools example model.</p>
<p>Classic eight-schools example model.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class EightSchoolsModel:
    &#34;&#34;&#34;Classic eight-schools example model.&#34;&#34;&#34;

    def __init__(self) -&gt; None:
        &#34;&#34;&#34;Classic eight-schools example model.&#34;&#34;&#34;
        return None

    def vars_regex(self, fit_method: ModelFitMethod) -&gt; list[str]:
        &#34;&#34;&#34;Regular expression to help with plotting only interesting variables.&#34;&#34;&#34;
        return [r&#34;.*&#34;]

    @property
    def schools_data(self) -&gt; SchoolsData:
        &#34;&#34;&#34;Eight-schools data.&#34;&#34;&#34;
        return SchoolsData(
            J=8, y=[28, 8, -3, 7, -1, 1, 18, 12], sigma=[15, 10, 16, 11, 9, 11, 10, 18]
        )

    def stan_model(
        self, data: pd.DataFrame, random_seed: Optional[int] = None
    ) -&gt; StanModel:
        &#34;&#34;&#34;Stan model for a the eight-schools example.

        Args:
            data (pd.DataFrame): Ignored.
            random_seed (Optional[int], optional): Random seed. Defaults to None.

        Returns:
            StanModel: Stan model.
        &#34;&#34;&#34;
        return stan.build(
            _eight_schools_stan_code,
            data=asdict(self.schools_data),
            random_seed=random_seed,
        )

    @property
    def stan_idata_addons(self) -&gt; dict[str, Any]:
        &#34;&#34;&#34;Information to add to the InferenceData posterior object.&#34;&#34;&#34;
        return {
            &#34;posterior_predictive&#34;: &#34;y_hat&#34;,
            &#34;observed_data&#34;: [&#34;y&#34;],
            &#34;log_likelihood&#34;: {&#34;y&#34;: &#34;log_lik&#34;},
            &#34;constant_data&#34;: [&#34;sigma&#34;],
            &#34;coords&#34;: {&#34;school&#34;: np.arange(self.schools_data.J)},
            &#34;dims&#34;: {
                &#34;theta&#34;: [&#34;school&#34;],
                &#34;y&#34;: [&#34;school&#34;],
                &#34;log_lik&#34;: [&#34;school&#34;],
                &#34;y_hat&#34;: [&#34;school&#34;],
                &#34;theta_tilde&#34;: [&#34;school&#34;],
            },
        }

    def pymc3_model(self, data: pd.DataFrame) -&gt; pm.Model:
        &#34;&#34;&#34;PyMC3  model for a simple negative binomial model.

        Not implemented.

        Args:
            data (pd.DataFrame): Ignored.

        Returns:
            pm.Model: PyMC3 model.
        &#34;&#34;&#34;
        school_data = self.schools_data
        with pm.Model() as model:
            mu = pm.Normal(&#34;mu&#34;, 0, 5)
            tau = pm.HalfCauchy(&#34;tau&#34;, 5)
            theta_tilde = pm.Normal(&#34;eta&#34;, 0, 1)
            theta = pm.Deterministic(&#34;theta&#34;, mu + tau * theta_tilde)
            y = pm.Normal(  # noqa: F841
                name=&#34;y&#34;,
                mu=theta,
                sigma=np.array(school_data.sigma),
                observed=school_data.y,
            )
        return model</code></pre>
</details>
<h3>Instance variables</h3>
<dl>
<dt id="speclet.bayesian_models.eight_schools.EightSchoolsModel.schools_data"><code class="name">var <span class="ident">schools_data</span> : <a title="speclet.bayesian_models.eight_schools.SchoolsData" href="#speclet.bayesian_models.eight_schools.SchoolsData">SchoolsData</a></code></dt>
<dd>
<div class="desc"><p>Eight-schools data.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def schools_data(self) -&gt; SchoolsData:
    &#34;&#34;&#34;Eight-schools data.&#34;&#34;&#34;
    return SchoolsData(
        J=8, y=[28, 8, -3, 7, -1, 1, 18, 12], sigma=[15, 10, 16, 11, 9, 11, 10, 18]
    )</code></pre>
</details>
</dd>
<dt id="speclet.bayesian_models.eight_schools.EightSchoolsModel.stan_idata_addons"><code class="name">var <span class="ident">stan_idata_addons</span> : dict[str, typing.Any]</code></dt>
<dd>
<div class="desc"><p>Information to add to the InferenceData posterior object.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def stan_idata_addons(self) -&gt; dict[str, Any]:
    &#34;&#34;&#34;Information to add to the InferenceData posterior object.&#34;&#34;&#34;
    return {
        &#34;posterior_predictive&#34;: &#34;y_hat&#34;,
        &#34;observed_data&#34;: [&#34;y&#34;],
        &#34;log_likelihood&#34;: {&#34;y&#34;: &#34;log_lik&#34;},
        &#34;constant_data&#34;: [&#34;sigma&#34;],
        &#34;coords&#34;: {&#34;school&#34;: np.arange(self.schools_data.J)},
        &#34;dims&#34;: {
            &#34;theta&#34;: [&#34;school&#34;],
            &#34;y&#34;: [&#34;school&#34;],
            &#34;log_lik&#34;: [&#34;school&#34;],
            &#34;y_hat&#34;: [&#34;school&#34;],
            &#34;theta_tilde&#34;: [&#34;school&#34;],
        },
    }</code></pre>
</details>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="speclet.bayesian_models.eight_schools.EightSchoolsModel.pymc3_model"><code class="name flex">
<span>def <span class="ident">pymc3_model</span></span>(<span>self, data: pandas.core.frame.DataFrame) -> pymc3.model.Model</span>
</code></dt>
<dd>
<div class="desc"><p>PyMC3
model for a simple negative binomial model.</p>
<p>Not implemented.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>data</code></strong> :&ensp;<code>pd.DataFrame</code></dt>
<dd>Ignored.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>pm.Model</code></dt>
<dd>PyMC3 model.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def pymc3_model(self, data: pd.DataFrame) -&gt; pm.Model:
    &#34;&#34;&#34;PyMC3  model for a simple negative binomial model.

    Not implemented.

    Args:
        data (pd.DataFrame): Ignored.

    Returns:
        pm.Model: PyMC3 model.
    &#34;&#34;&#34;
    school_data = self.schools_data
    with pm.Model() as model:
        mu = pm.Normal(&#34;mu&#34;, 0, 5)
        tau = pm.HalfCauchy(&#34;tau&#34;, 5)
        theta_tilde = pm.Normal(&#34;eta&#34;, 0, 1)
        theta = pm.Deterministic(&#34;theta&#34;, mu + tau * theta_tilde)
        y = pm.Normal(  # noqa: F841
            name=&#34;y&#34;,
            mu=theta,
            sigma=np.array(school_data.sigma),
            observed=school_data.y,
        )
    return model</code></pre>
</details>
</dd>
<dt id="speclet.bayesian_models.eight_schools.EightSchoolsModel.stan_model"><code class="name flex">
<span>def <span class="ident">stan_model</span></span>(<span>self, data: pandas.core.frame.DataFrame, random_seed: Optional[int] = None) -> stan.model.Model</span>
</code></dt>
<dd>
<div class="desc"><p>Stan model for a the eight-schools example.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>data</code></strong> :&ensp;<code>pd.DataFrame</code></dt>
<dd>Ignored.</dd>
<dt><strong><code>random_seed</code></strong> :&ensp;<code>Optional[int]</code>, optional</dt>
<dd>Random seed. Defaults to None.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>StanModel</code></dt>
<dd>Stan model.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def stan_model(
    self, data: pd.DataFrame, random_seed: Optional[int] = None
) -&gt; StanModel:
    &#34;&#34;&#34;Stan model for a the eight-schools example.

    Args:
        data (pd.DataFrame): Ignored.
        random_seed (Optional[int], optional): Random seed. Defaults to None.

    Returns:
        StanModel: Stan model.
    &#34;&#34;&#34;
    return stan.build(
        _eight_schools_stan_code,
        data=asdict(self.schools_data),
        random_seed=random_seed,
    )</code></pre>
</details>
</dd>
<dt id="speclet.bayesian_models.eight_schools.EightSchoolsModel.vars_regex"><code class="name flex">
<span>def <span class="ident">vars_regex</span></span>(<span>self, fit_method: <a title="speclet.project_enums.ModelFitMethod" href="../project_enums.html#speclet.project_enums.ModelFitMethod">ModelFitMethod</a>) -> list[str]</span>
</code></dt>
<dd>
<div class="desc"><p>Regular expression to help with plotting only interesting variables.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def vars_regex(self, fit_method: ModelFitMethod) -&gt; list[str]:
    &#34;&#34;&#34;Regular expression to help with plotting only interesting variables.&#34;&#34;&#34;
    return [r&#34;.*&#34;]</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="speclet.bayesian_models.eight_schools.SchoolsData"><code class="flex name class">
<span>class <span class="ident">SchoolsData</span></span>
<span>(</span><span>J: int, y: list[float], sigma: list[int])</span>
</code></dt>
<dd>
<div class="desc"><p>Data structure for the eight-schools data.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@dataclass(frozen=True)
class SchoolsData:
    &#34;&#34;&#34;Data structure for the eight-schools data.&#34;&#34;&#34;

    J: int
    y: list[float]
    sigma: list[int]</code></pre>
</details>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="speclet.bayesian_models" href="index.html">speclet.bayesian_models</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="speclet.bayesian_models.eight_schools.EightSchoolsModel" href="#speclet.bayesian_models.eight_schools.EightSchoolsModel">EightSchoolsModel</a></code></h4>
<ul class="">
<li><code><a title="speclet.bayesian_models.eight_schools.EightSchoolsModel.pymc3_model" href="#speclet.bayesian_models.eight_schools.EightSchoolsModel.pymc3_model">pymc3_model</a></code></li>
<li><code><a title="speclet.bayesian_models.eight_schools.EightSchoolsModel.schools_data" href="#speclet.bayesian_models.eight_schools.EightSchoolsModel.schools_data">schools_data</a></code></li>
<li><code><a title="speclet.bayesian_models.eight_schools.EightSchoolsModel.stan_idata_addons" href="#speclet.bayesian_models.eight_schools.EightSchoolsModel.stan_idata_addons">stan_idata_addons</a></code></li>
<li><code><a title="speclet.bayesian_models.eight_schools.EightSchoolsModel.stan_model" href="#speclet.bayesian_models.eight_schools.EightSchoolsModel.stan_model">stan_model</a></code></li>
<li><code><a title="speclet.bayesian_models.eight_schools.EightSchoolsModel.vars_regex" href="#speclet.bayesian_models.eight_schools.EightSchoolsModel.vars_regex">vars_regex</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="speclet.bayesian_models.eight_schools.SchoolsData" href="#speclet.bayesian_models.eight_schools.SchoolsData">SchoolsData</a></code></h4>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.8.1</a>.</p>
</footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
</body>
</html>