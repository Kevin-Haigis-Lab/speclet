# Run test suite.

name: "pytest"

on:
  workflow_dispatch:
  schedule:
    - cron:  '0 3 * * MON'
  push:
    branches:
      - master
  pull_request:
    branches:
      - master

defaults:
  run:
    shell: bash -l {0}

jobs:
  pytest:
    name: "pytest suite"
    runs-on: "ubuntu-latest"
    steps:
      - uses: actions/checkout@v2

      - name: "Install conda"
        uses: conda-incubator/setup-miniconda@v2

      - name: "Create and setup conda environment"
        run: |
          conda install -n base --yes -c conda-forge mamba
          mamba env create -f conda.yaml
          conda activate speclet

      - name: "Describe environment"
        run: |
          conda activate speclet
          pwd
          ls -lha
          python3 --version
          which python3
          conda env list
          conda list

      - name: "Run test suite"
        run: |
          conda activate speclet
          python3 -m pytest \
            --disable-warnings \
            --force-sugar \
            tests
